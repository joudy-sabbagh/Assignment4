@* Views/Tickets/Index.cshtml *@
@model IEnumerable<Application.DTOs.TicketListDTO>
    @using Domain.Entities
    @{
    ViewData["Title"] = "Tickets";

    // carry over filter/sort dropdowns as before
    var events       = ViewData["Events"]    as IEnumerable<Event>             ?? Enumerable.Empty<Event>();
    var categoryList = ViewData["CategoryList"] as IEnumerable<TicketCategory>
                          ?? Enum.GetValues(typeof(TicketCategory)).Cast<TicketCategory>();

    var request    = ViewContext.HttpContext.Request.Query;
    var sortOrder  = request["sortOrder"].ToString();
    var eventF     = request["eventFilter"].ToString();
    var catF       = request["categoryFilter"].ToString();
    var newSort    = sortOrder == "price_asc" ? "price_desc" : "price_asc";
    int? selEvent  = int.TryParse(eventF, out var evv) ? evv : null;
    TicketCategory? selCat = Enum.TryParse<TicketCategory>(catF, out var ccv) ? ccv : null;
    string Icon(TicketCategory c) => c switch {
        TicketCategory.VIP => "üëë",
        TicketCategory.Backstage => "üîë",
        _ => "üéüÔ∏è"
    };
    }

    <h1>Tickets</h1>

    <form method="get" asp-action="Index" class="form-inline mb-3">
        <div class="form-group mr-2">
            <label>Event:</label>
            <select name="eventFilter" class="form-control ml-2">
                <option value="">-- All Events --</option>
                @foreach(var ev in events) {
                <option value="@ev.Id" selected="@(ev.Id == selEvent)">
                    @ev.Name
                </option>
            }
            </select>
        </div>
        <div class="form-group mr-2">
            <label>Category:</label>
            <select name="categoryFilter" class="form-control ml-2">
                <option value="">-- All Categories --</option>
                @foreach(var cat in categoryList) {
                <option value="@cat" selected="@(cat == selCat)">
                    @cat
                </option>
            }
            </select>
        </div>
        <input type="hidden" name="sortOrder" value="@sortOrder" />
        <button class="btn btn-primary">Filter</button>
    </form>

    <p><a asp-action="Create" class="btn btn-success">Create Ticket</a></p>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>
                    <a asp-action="Index"
                       asp-route-sortOrder="@newSort"
                       asp-route-eventFilter="@eventF"
                       asp-route-categoryFilter="@catF">
                        Price @(sortOrder=="price_asc"?"‚Üë":sortOrder=="price_desc"?"‚Üì":"")
                    </a>
                </th>
                <th>Category</th>
                <th>Event</th>
                <th>Attendee</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach(var t in Model) {
            <tr>
                <td>@t.Price</td>
                <td>@Icon(Enum.Parse<TicketCategory>(t.Category)) @t.Category</td>
                <td>@t.EventName</td>
                <td>@t.AttendeeName</td>
                <td>
                    <a asp-action="Edit" asp-route-id="@t.Id">Edit</a> |
                    <a asp-action="Delete" asp-route-id="@t.Id">Delete</a>
                </td>
            </tr>
    }
        </tbody>
    </table>
